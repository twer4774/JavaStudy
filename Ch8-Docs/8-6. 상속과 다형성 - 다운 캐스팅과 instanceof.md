# 8-6. 상속과 다형성 - 다운 캐스팅과 instanceof

## 하위 클래스로 형 변환, 다운 캐스팅

- 다운 캐스팅 : 상위 클래스로 형 변환 되었던 것을 다시 원래 자료형으로 변환하는 것

  ```java
  Animal ani = new Human();
  //Animal 클래스에서 선언한 메소드와 멤버 변수만 사용할 수 있음 => Human에 기능이 더 많더라도 Human의 메소드를 사용할 수 없음
  //=> Human의 메소드등을 사용하기 위해 ani를 Human으로 자료형을 아래로 낮추는것을 다운캐스팅이라고 부릅니다.
  ```

## instanceof

- 다운 캐스팅을 하기 전에 상위 클래스로 형 변환된 인스턴스의 원래 자료형을 확인해야 변환할 때 오류를 막을 수 있습니다.
  - instancof  사용

```java
Animal hAnimal = new Human();
if(hAnimal instanceof Human){ //hAnimal인스턴스 자료형이 Human형이라면
  Human human = (Human)hAnimal; //인스턴스 hAnimal을 Human형으로 다운 캐스팅
}

//instanceof를 사용해야하는 이유
//=> 아래코드는 컴파일에서는 문제 없지만, 런타임에서 오류가 발생합니다. 따라서 형 변환전에 instanceof로 확인해야 다운캐스팅의 안전성을 확보할 수 있습니다.
Animal ani = new Tiger();
Human h = (Human)ani;
```

- 상위 클래스로는 묵시적으로 형변환이 이루어지지만(업캐스팅), 다운 캐스팅인 경우 명시적으로 표시해주어야 합니다.

```java
package Instanceof;

import java.util.ArrayList;

class Animal{
    public void move(){
        System.out.println("동물이 움직입니다.");
    }
}


class Human extends Animal{
    public void move(){
        System.out.println("사람이 두 발로 걷습니다.");
    }

    public void readBook(){
        System.out.println("사람이 책을 읽습니다.");
    }
}

class Tiger extends Animal{
    public void move(){
        System.out.println("호랑이가 네 발로 뜁니다.");
    }

    public void hunting(){
        System.out.println("호랑이가 사냥을 합니다.");
    }
}

class Eagle extends Animal{
    public void move(){
        System.out.println("독수리가 하늘을 납니다.");
    }

    public void flying(){
        System.out.println("독수리가 날개를 쭉 펴고 날아갑니다.");
    }
}

public class AnimalTest {

    ArrayList<Animal> aniList = new ArrayList<Animal>();

    public static void main(String[] args) {
        AnimalTest aTest = new AnimalTest();
        aTest.addAnimal();
        System.out.println("원래 형으로 다운 캐스팅");
        aTest.testCasting();
    }

    private void addAnimal() {
        aniList.add(new Human());
        aniList.add(new Tiger());
        aniList.add(new Eagle());

        for (Animal ani : aniList) {
            ani.move();
        }
    }

    private void testCasting() {
        for (int i = 0; i < aniList.size(); i++) {
            Animal ani = aniList.get(i);
            if(ani instanceof Human){
                Human h = (Human)ani;
                h.readBook();
            }
            else if(ani instanceof Tiger){
                Tiger t = (Tiger)ani;
                t.hunting();
            }
            else if(ani instanceof Eagle){
                Eagle e = (Eagle)ani;
                e.flying();
            }
            else {
                System.out.println("지원 되지 않는 형입니다.");
            }
        }
    }

}
/*
사람이 두 발로 걷습니다.
호랑이가 네 발로 뜁니다.
독수리가 하늘을 납니다.
원래 형으로 다운 캐스팅
사람이 책을 읽습니다.
호랑이가 사냥을 합니다.
독수리가 날개를 쭉 펴고 날아갑니다.
*/
```

